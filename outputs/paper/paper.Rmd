---
title: "My title"
subtitle: "My subtitle if needed"
author: 
  - Luxuan Zhu
thanks: "Code and data are available at: LINK."
date: "`r format(Sys.time(), '%d %B %Y')`"
abstract: "First sentence. Second sentence. Third sentence. Fourth sentence."
output: pdf_document
toc: FALSE
bibliography: references.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

install.packages("ggmap")
install.packages("mapproj")
install.packages("gridExtra")
install.packages("modelsummary")
install.packages("svglite", type = "source")

library(opendatatoronto)
library(dplyr)
library(tidyverse)
library(ggplot2)
library(ggmap)
library(mapproj)
library(maps)
library(knitr)
library(gridExtra)
library(modelsummary)
library(svglite)
```

# Introduction (talk about dataset, findings, and conclusion)

# 1st paragraph: motivation and broad
# 2nd paragraph: what I did and findings
# 3 paragraph: implications
# precisely discuss the source of data and the bias it brings (ethical, statistical, etc.)

Fire incidents occur everyday around the world. In most societies, these incidents are a source of threat to safety, capital, buildings, and societal development. They occur in different locations, with different causes, and result in damages to different extends. To further understand the causes of unintentional house fires, Turner and her peers conducted literature research and found that demographic factors such as age, gender, and socio-economic status can contribute to fire incidents. Moreover, social factors such as household composition, property characteristics, and fire safety practices can potentially cause house fires. An important observation from the study is that older and disabled residents are more likely to suffer an injury or fatality in the event of a fire, while they are less likely to ignite the fire in the first place. [@risk_factor] Therefore, It is important for a society to look at the characteristics across fire incidents and further prevent future events, especially to protect those who are more in need for help and support. 

An inevitable consideration while working with a dataset of real incidents is ethics. One needs to consider who are represented by the dataset and who are excluded. Under ethical considerations, what does it mean to make conclusions and thus influences based on the dataset? Looking at the source of the dataset, one can assume that the dataset does not record all fire incidents in Toronto. For instance, some incidents were excluded due to privacy concerns, while some may simply not be reported. Then, it is important to consider the groups of people influenced by the fire incidents. The dataset does not reflect the demographic of the persons involved, thus each incident may associate with any one person or group, with any demographic information, under any circumstance. Thus, for instance, when a statistician concludes that one type of fire incident is more significant than another type, the same affect may apply to the individuals associated behind the two types of incidents. Does that mean the group of individuals associated with the more severe incident type "deserve" more support? These questions are crucial to people such as statisticians and policy setters who might rely on results derived from the dataset to make certain decisions that would, directly or indirectly, influence the society. 

This paper provides an in-depth analysis on the fire incidents occurred in cooking areas or kitchens located in Toronto, ON. Specifically, the author is interested in exploring the differences in estimated money loss as a result of the fire incidents, categorized by whether the fire alarm system was operated. The author's hypothesis is that fire incidents where the fire alarm system did not operate or did not exist would result in higher estimated dollar loss compared to those where the fire alarm system operated. Such a hypothesis 

The author found that...

The remainder of the paper will follow the structure of: Section \@ref(data) explains the data; Section \@ref(Model) showcases the models to support the analysis; Section \@ref(Results) covers the results of the models; Section...

# Data (generate a table and talk about the variables)

The dataset is obtained from Open Data Toronto [@citeopendatatoronto] using R [@citeR]. The dataset provides information on 17536 fire incidents to which Toronto Fire responds in more detail, as displayed by the 43 variables including Area of Origin, Extend of Fire, and Estimated Dollar Loss. The dataset includes only fire incidents defined by the Ontario Fire Marshal, which means it does not capture all fire incidents in Toronto. Since the fire incidents recorded are actual events related to citizens of Toronto and the society as a whole, personal information is not provided and the exact address have been approximated to the nearest intersections for privacy purposes. Moreover, the dataset follows exemptions under Section 8 of Municipal Freedom of Information and Protection of Privacy Act (MFIPPA) and excludes certain incidents.

For the purpose of the paper, the analysis will focus on the fire incidents occurred in cooking areas or kitchens. Moreover, the author is interested in exploring the relationship between the estimated dollar loss and the fire alarm system operation among the selected kitchen fire incidents. To do so, the author uses Tidyverse [@citetidyverse] to select the variables of "Area of Origin", "Fire Alarm System Operation", "Latitude", "Longitude", and "Estimated Dollar Loss". The author also removes all entrants with missing values for any of the variables. The following shows an extract of the cleaned dataset (Table \@ref(tab:dataextract)).

The first variable, Area of Origin, shows the initial cause of the fire incidents. In the context of this paper, all observations should contain the Area of Origin of "24 - Cooking Area or Kitchen". The second variable of Fire Alarm System Operation shows the status of the fire alarm system during the fire incident. The four statuses include: Fire alarm system operated; Fire alarm system did not operate; not applicable (no system); and Fire alarm system operation undetermined. The next two variables, longitude and latitude, are used in mapping the locations of the fire incidents. Lastly, the Estimated Dollar Loss showcases the financial consequences of each fire incident. 

```{r dataextract}
fire_incidents <-
  read_csv("~/Session1/STA304_Paper_1/inputs/data/fire_incidents.csv")

cleaned_data <-
  fire_incidents %>%
  select(Area_of_Origin, Fire_Alarm_System_Operation, Extent_Of_Fire, Building_Status, Latitude, Longitude, Estimated_Dollar_Loss) %>%
  filter(Area_of_Origin == "24 - Cooking Area or Kitchen") %>%
  filter(!is.na(Fire_Alarm_System_Operation)) %>%
  filter(!is.na(Latitude)) %>%
  filter(!is.na(Longitude)) %>%
  filter(!is.na(Extent_Of_Fire)) %>%
  filter(!is.na(Estimated_Dollar_Loss))

data_extract <-
  cleaned_data %>% 
    slice(1:10) %>%
      kable(
      caption = "First ten rows of a dataset of fire incidents in Toronto",
      col.names = c("Area of Origin", "Fire Alarm System Operation", "Extent of Fire", "Building Status", "Latitude", "Longitude", "Estimated Dollar Loss"),
      digits = 1,
      booktabs = TRUE, 
      linesep = ""
    )

data_extract
```

# Model

# Map

To gain a visual representation of the distribution of fire incidents within the city of Toronto, the author uses ggmap [@citeggmap], mapproj [@citemapproj], and maps [@citemaps] to construct a map pinpointing the locations of selected data points. Due to the high number of observations, the author chooses to focus on fire incidents that either spread to other floors within the building, spread to the entire structure, or spread to the roof or the exterior of the building. All fire incidents are still initialized in the kitchen area. The justification for such a niche selection is to have the map display the fire incidents that extended beyond its area of origin and caused larger areas of damage. Then, the author plots the data points using colours sorted by the building status of each incident. The possible values are: normal, under rennovation, under construction, and unknown. The final resulting map is shown below.

```{r, echo=FALSE, message=FALSE}
# Create Map

t <- max(cleaned_data$Latitude)
b <- min(cleaned_data$Latitude)
l <- min(cleaned_data$Longitude)
r <- max(cleaned_data$Longitude)
bbox <- c(left = -79.637, bottom = 43.587, right = -79.123, top = 43.848)

area <- get_stamenmap(bbox, zoom = 11, maptype = "toner-lite")
```

```{r, echo=FALSE, message=FALSE}
target = c("7 - Spread to other floors, confined to building", "8 - Entire Structure", "9 - Confined to roof/exterior structure")

map_data <-
  cleaned_data %>%
  filter(Extent_Of_Fire %in% target)

final_map <- 
  ggmap(area,
      extent = "normal",
      maprange = FALSE) +
  geom_point(data = map_data,
             aes(x = Longitude,
                 y = Latitude,
                 colour = Building_Status),) +
  scale_color_brewer(name = "Kitchen Fire Incidents by Building Status", palette = "Set1") +
  coord_map(
    projection = "mercator",
    xlim = c(r,l),
    ylim = c(b,t)
  ) +
  labs(x = "Longitude",
       y = "Latitude") +
  theme_minimal() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank())

final_map
```

# Histogram

In addition to a map, the author is also interested seeing the difference between the distributions of estimated dollar loss relative to the fire alarm system. The author's hypothesis is that fire incidents where the fire alarm did not operate, was absent, or was undetermined, would contribute to a higher estimated dollar loss. In contrast, fire incidents where the fire alarm system operated would result in faster reactions and thus lower estimated dollar loss. Therefore, to test such a hypothesis, the author creates two histograms with estimated dollar loss on the x-axis and the number of fire incidents on the y-axis. The data input is the same cleaned dataset where the area of origin focuses on cooking area/kitchen. The histogram on the left represents the distribution of estimated dollar loss for fire incidents with operating fire alarm systems, whereas the graph on the right represents the remaining fire incidents where the fire alarm system was either undetermined, absent, or did not operate. To get a closer observation of the distributions, the author excluded the fire incidents with estimated dollar loss higher than \$250,000. The detailed breakdown of the outliers are represented by the table below.  

```{r}
cleaned_data %>%
  filter(Estimated_Dollar_Loss >= 250000) %>%
  group_by(Fire_Alarm_System_Operation) %>%
  summarize(n = n())
```


```{r}
final_graph1 <- 
  cleaned_data %>%
  filter(Fire_Alarm_System_Operation == "1 - Fire alarm system operated") %>%
  ggplot(mapping = aes(x = Estimated_Dollar_Loss)) +
  geom_histogram(bins = 100) +
  xlim(0, 250000) +
  ylim(0, 250) +
  labs(x = "Estimated dollar loss",
       y = "# of fire incidents",
       title = "Estimated Dollar Loss - Fire Incidents \n With Operating Fire Alarm Systems \n (n = 1292)")

final_graph2 <- 
  cleaned_data %>%
  filter(Fire_Alarm_System_Operation != "1 - Fire alarm system operated") %>%
  ggplot(mapping = aes(x = Estimated_Dollar_Loss)) +
  geom_histogram(bins = 100) +
  xlim(0, 250000) +
  ylim(0, 250) +
  labs(x = "Estimated dollar loss",
       y = "# of fire incidents",
       title = "Estimated Dollar Loss - Fire Incidents \n Without Operating Fire Alarm Systems \n (n = 1548)") 

grid.arrange(final_graph1, final_graph2, ncol=2)

graph_data <-
  cleaned_data %>% 
    filter(Estimated_Dollar_Loss <= 250000)

graph_data %>% 
  select(Fire_Alarm_System_Operation) %>%
  datasummary_skim(type = "categorical")

```


# Results

# Discussion

## First discussion point

If my paper were 10 pages, then should be be at least 2.5 pages. The discussion is a chance to show off what you know and what you learnt from all this. 

## Second discussion point

## Third discussion point

## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage

\appendix

# Appendix {-}


# Additional details


\newpage


# References